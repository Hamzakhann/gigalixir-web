import React from 'react';
import { Line } from 'react-chartjs-2';
import { ExceptionHandler } from 'winston';
import { isFlowBaseAnnotation } from '@babel/types';

type ChartProps = any

const stats = [[1565974080000,null],[1565974140000,586880341.3333334],[1565974200000,587998549.3333334],[1565974260000,593066666.6666666],[1565974320000,593563648],[1565974380000,591043242.6666666],[1565974440000,588644352],[1565974500000,592255658.6666666],[1565974560000,590768810.6666666],[1565974620000,593958229.3333334],[1565974680000,595533824],[1565974740000,588529664],[1565974800000,585730730.6666666],[1565974860000,589690197.3333334],[1565974920000,589034837.3333334],[1565974980000,594130261.3333334],[1565975040000,590240426.6666666],[1565975100000,592385365.3333334],[1565975160000,592075434.6666666],[1565975220000,593017514.6666666],[1565975280000,593211392],[1565975340000,593024341.3333334],[1565975400000,592613376],[1565975460000,591668565.3333334],[1565975520000,589968725.3333334],[1565975580000,593107626.6666666],[1565975640000,591575722.6666666],[1565975700000,598563498.6666666],[1565975760000,595656704],[1565975820000,595368618.6666666],[1565975880000,585056256],[1565975940000,590331904],[1565976000000,586178560],[1565976060000,591377749.3333334],[1565976120000,593866752],[1565976180000,590628181.3333334],[1565976240000,587751424],[1565976300000,584497834.6666666],[1565976360000,585007104],[1565976420000,591346346.6666666],[1565976480000,590053376],[1565976540000,591963477.3333334],[1565976600000,587930282.6666666],[1565976660000,584702634.6666666],[1565976720000,585984682.6666666],[1565976780000,588253866.6666666],[1565976840000,592233813.3333334],[1565976900000,593197738.6666666],[1565976960000,590719658.6666666],[1565977020000,589440341.3333334],[1565977080000,592046762.6666666],[1565977140000,592325290.6666666],[1565977200000,590761984],[1565977260000,588550144],[1565977320000,582651904],[1565977380000,585207808],[1565977440000,585075370.6666666],[1565977500000,590000128],[1565977560000,590820693.3333334],[1565977620000,595050496],[1565977680000,587415552],[1565977740000,583023274.6666666],[1565977800000,584404992],[1565977860000,596960597.3333334],[1565977920000,584966144],[1565977980000,585091754.6666666],[1565978040000,582520832],[1565978100000,586032469.3333334],[1565978160000,585231018.6666666],[1565978220000,588414976],[1565978280000,591650816],[1565978340000,586543104],[1565978400000,585475413.3333334],[1565978460000,589686101.3333334],[1565978520000,591224832],[1565978580000,594243584],[1565978640000,591813290.6666666],[1565978700000,594580821.3333334],[1565978760000,590162602.6666666],[1565978820000,592209237.3333334],[1565978880000,590837077.3333334],[1565978940000,594717354.6666666],[1565979000000,595722240],[1565979060000,593499477.3333334],[1565979120000,593241429.3333334],[1565979180000,590457514.6666666],[1565979240000,594006016],[1565979300000,592885077.3333334],[1565979360000,591421440],[1565979420000,590512128],[1565979480000,589329749.3333334],[1565979540000,588652544],[1565979600000,588076373.3333334],[1565979660000,592665258.6666666],[1565979720000,591742293.3333334],[1565979780000,591014570.6666666],[1565979840000,587565738.6666666],[1565979900000,592072704],[1565979960000,594281813.3333334],[1565980020000,595365888],[1565980080000,595430058.6666666],[1565980140000,597315584],[1565980200000,596417194.6666666],[1565980260000,601736533.3333334],[1565980320000,600403968],[1565980380000,600124074.6666666],[1565980440000,603552426.6666666],[1565980500000,598167552],[1565980560000,593528149.3333334],[1565980620000,587950762.6666666],[1565980680000,588361728],[1565980740000,591459669.3333334],[1565980800000,592756736],[1565980860000,592565589.3333334],[1565980920000,584901973.3333334],[1565980980000,586869418.6666666],[1565981040000,588118698.6666666],[1565981100000,591654912],[1565981160000,590628181.3333334],[1565981220000,590129834.6666666],[1565981280000,588846421.3333334],[1565981340000,590660949.3333334],[1565981400000,592165546.6666666],[1565981460000,591597568],[1565981520000,592545109.3333334],[1565981580000,590760618.6666666],[1565981640000,590883498.6666666],[1565981700000,592601088],[1565981760000,594365098.6666666],[1565981820000,596103168],[1565981880000,594318677.3333334],[1565981940000,597400234.6666666],[1565982000000,596258816],[1565982060000,593440768],[1565982120000,597162666.6666666],[1565982180000,596779008],[1565982240000,596348928],[1565982300000,594184874.6666666],[1565982360000,591938901.3333334],[1565982420000,589687466.6666666],[1565982480000,590622720],[1565982540000,594893482.6666666],[1565982600000,591501994.6666666],[1565982660000,589677909.3333334],[1565982720000,587049642.6666666],[1565982780000,590453418.6666666],[1565982840000,589015722.6666666],[1565982900000,595289429.3333334],[1565982960000,591732736],[1565983020000,588595200],[1565983080000,590968149.3333334],[1565983140000,590139392],[1565983200000,591497898.6666666],[1565983260000,592121856],[1565983320000,590824789.3333334],[1565983380000,589505877.3333334],[1565983440000,589043029.3333334],[1565983500000,591249408],[1565983560000,591581184],[1565983620000,590517589.3333334],[1565983680000,592457728],[1565983740000,593155413.3333334],[1565983800000,592258389.3333334],[1565983860000,588454570.6666666],[1565983920000,593963690.6666666],[1565983980000,594109781.3333334],[1565984040000,600607402.6666666],[1565984100000,594565802.6666666],[1565984160000,591417344],[1565984220000,596213760],[1565984280000,600231936],[1565984340000,598930773.3333334],[1565984400000,594063360],[1565984460000,596836352],[1565984520000,589292885.3333334],[1565984580000,590233600],[1565984640000,591643989.3333334],[1565984700000,595178837.3333334],[1565984760000,592409941.3333334],[1565984820000,597404330.6666666],[1565984880000,591699968],[1565984940000,589653333.3333334],[1565985000000,589062144],[1565985060000,595249834.6666666],[1565985120000,592486400],[1565985180000,593193642.6666666],[1565985240000,591743658.6666666],[1565985300000,587410090.6666666],[1565985360000,591637162.6666666],[1565985420000,590779733.3333334],[1565985480000,590824789.3333334],[1565985540000,590082048],[1565985600000,588571989.3333334],[1565985660000,588404053.3333334],[1565985720000,594220373.3333334],[1565985780000,593769813.3333334],[1565985840000,588511914.6666666],[1565985900000,589388458.6666666],[1565985960000,590499840],[1565986020000,586132138.6666666],[1565986080000,590981802.6666666],[1565986140000,589697024],[1565986200000,589279232],[1565986260000,594173952],[1565986320000,588367189.3333334],[1565986380000,591131989.3333334],[1565986440000,593252352],[1565986500000,593947306.6666666],[1565986560000,589275136],[1565986620000,592879616],[1565986680000,588178773.3333334],[1565986740000,585003008],[1565986800000,586833920],[1565986860000,589643776],[1565986920000,589773482.6666666],[1565986980000,592240640],[1565987040000,585775786.6666666],[1565987100000,585898666.6666666],[1565987160000,589320192],[1565987220000,589777578.6666666],[1565987280000,589970090.6666666],[1565987340000,590659584],[1565987400000,590700544],[1565987460000,591575722.6666666],[1565987520000,591650816],[1565987580000,594093397.3333334],[1565987640000,592020821.3333334],[1565987700000,589929130.6666666],[1565987760000,589137237.3333334],[1565987820000,589941418.6666666],[1565987880000,588782250.6666666],[1565987940000,593111722.6666666],[1565988000000,589200042.6666666],[1565988060000,589374805.3333334],[1565988120000,587520682.6666666],[1565988180000,590491648],[1565988240000,589828096],[1565988300000,594244949.3333334],[1565988360000,593519957.3333334],[1565988420000,587359573.3333334],[1565988480000,589931861.3333334],[1565988540000,585194154.6666666],[1565988600000,584339456],[1565988660000,589529088],[1565988720000,588128256],[1565988780000,594957653.3333334],[1565988840000,585936896],[1565988900000,589978282.6666666],[1565988960000,591226197.3333334],[1565989020000,591364096],[1565989080000,590969514.6666666],[1565989140000,588599296],[1565989200000,592569685.3333334],[1565989260000,590109354.6666666],[1565989320000,589303808],[1565989380000,595806890.6666666],[1565989440000,592267946.6666666],[1565989500000,589331114.6666666],[1565989560000,589408938.6666666],[1565989620000,591521109.3333334],[1565989680000,590259541.3333334],[1565989740000,594819754.6666666],[1565989800000,599638016],[1565989860000,596260181.3333334],[1565989920000,594900309.3333334],[1565989980000,594837504],[1565990040000,594848426.6666666],[1565990100000,595663530.6666666],[1565990160000,593879040],[1565990220000,593511765.3333334],[1565990280000,587265365.3333334],[1565990340000,587497472],[1565990400000,591959381.3333334],[1565990460000,593661952],[1565990520000,594718720],[1565990580000,587513856],[1565990640000,586304170.6666666],[1565990700000,588813653.3333334],[1565990760000,584770901.3333334],[1565990820000,592236544],[1565990880000,593761621.3333334],[1565990940000,590989994.6666666],[1565991000000,586313728],[1565991060000,587422378.6666666],[1565991120000,590962688],[1565991180000,594180778.6666666],[1565991240000,593555456],[1565991300000,592480938.6666666],[1565991360000,592474112],[1565991420000,593189546.6666666],[1565991480000,593433941.3333334],[1565991540000,593844906.6666666],[1565991600000,593076224],[1565991660000,586792960],[1565991720000,583288149.3333334],[1565991780000,584009045.3333334],[1565991840000,587878400],[1565991900000,588820480],[1565991960000,588784981.3333334],[1565992020000,585476778.6666666],[1565992080000,585573717.3333334],[1565992140000,589769386.6666666],[1565992200000,587609429.3333334],[1565992260000,591713621.3333334],[1565992320000,593313792],[1565992380000,592846848],[1565992440000,592198314.6666666],[1565992500000,587033258.6666666],[1565992560000,589520896],[1565992620000,590579029.3333334],[1565992680000,589639680],[1565992740000,590076586.6666666],[1565992800000,588079104],[1565992860000,590256810.6666666],[1565992920000,587833344],[1565992980000,592882346.6666666],[1565993040000,589482666.6666666],[1565993100000,588658005.3333334],[1565993160000,592351232],[1565993220000,591279445.3333334],[1565993280000,594378752]]
type dataValue = number | null
type statsDataPoint = (dataValue)[]
type chartDataPoint = {
    x: number,
    y: dataValue
} 
const formatStatsForChart = (data: statsDataPoint[]): chartDataPoint[] => data.map(formatStatsPointForChart)
const formatStatsPointForChart = (point: statsDataPoint): chartDataPoint => {
    var [x, y] = point
    if (x === null) {
        throw new Error("data point x can not be null")
    }
    if (y !== null) {
        y /= 1000000 // convert to megabytes
    }
    return {
        x: x,
        y: y
    }
}
const data = {
    datasets: [
        {
            pointRadius: 1,
            data: formatStatsForChart(stats)
        }
    ]
};

const options = {
    title: {
        display: true,
        text: 'Memory (MB)'
    },
    legend: {
        display: false
    },
    scales: {
        xAxes: [{
            type: 'time',
        }],
        yAxes: [{
            ticks: {
                beginAtZero: true
            }
        }]
    }
}

export const Chart: React.FunctionComponent<ChartProps> = (props): React.ReactElement => (
    <Line data={data} options={options}/>
);